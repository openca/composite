# Installing Jekyll locally

## Install Ruby and Tools

Follow the instructions at this page:
- https://jekyllrb.com/docs/installation/

For MacOS, make sure you do not use the default
version of ruby. You can find more info here:
- https://jekyllrb.com/docs/installation/macos/

### Install via brew

To install chruby and ruby-install via brew, the
first step is to install the management tools:

```
  $ brew install chruby ruby-install
```

and then install ruby:

```
  $ ruby-install ruby
```

Now we can install Jekyll:

```
  $ gem install jekyll
```

## Using bundle and local gems

If you want to use Jekyll with bundler and do not want to depend
on the "system" gems, you can use the procedures defined here:
- https://jekyllrb.com/tutorials/using-jekyll-with-bundler/

In particular, in the initial (empty) directory of the new project,
you have to run the initialization:

```
  $ mkdir blog_site
  $ cd blog_site
  $ bundle init
```

Now we can install the gems locally, to do that you need to configure
bundle to save in the local directory instead of the system one:

```
  $ bundle config set --local path 'vendor/bundle'
```

Now you can add all the gems needed, included a local Jekyll instance:

```
  $ bundle add jekyll
```

## Initializing the project

To create the initial scaffolding, you can use the 'jekyll new' command
or its bundle-equivalent:

```
  $ bundle exec jekyll new --foce --skip-bundle .
  $ bundle install
```

Now you are ready to start the server.

## Serving the Website

In order to serve the website, you can run the Jekyll
serve command, however there might be a missing gem you
need to install if you are running into any issue:
```
  $ bundle add webrick
```

Now you can run the website locally:
```
  $ bundle exec jekyll serve
```

To automatically rebuild the site, use the '--livereload' switch:

```
  $ bundle exec jekyll serve --livereload
```

NOTE: There are some comments about the use of the '--watch', however
the use of '--livereload' seems to be pretty powerful:
- [https://www.youtube.com/watch?v=SvVMFyPkX00]

## Testing Locally and Remote Themes

In order to test your site locally and not having to do a commit
every time you make a change, you can use the procedures identified
in here:
- [https://dev.to/derlin/testing-github-pages-with-remote-theme-locally-3nid]

Where basically you need to:
- add a new _config_dev.yml file that is used additionally
- run jakyll with the new config file:

    $ bundle exec jekyll serve \
        --config "_config.yml,_config_dev.yml" \
        --livereload

## Generating New Projects

Once Jekyll and the other tools are installed on the platform,
to generate a new project is quite simple:
```
  $ mkdir <new_project>
  $ cd <new_project>
  $ bundle init
  $ bundle add jekyll
  $ bundle exec jekyll new --force --skip-bundle .
  $ bundle install
```

Now you are ready to serve your new site:
```
  $ bundle exec jekyll serve
```

## Updating the github-pages gem

Please refer to the following URL:
- [https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/testing-your-github-pages-site-locally-with-jekyll]

# Integrating with Github pages

You can run jekyll locally and also use the Github pages service for
your project. To prepare for it, first create the project as in the
previous section.

## Adding the github-pages dependencies

To add all the dependencies, you need to edit your Gemfile:
- comment out the line 'gem "jekyll", "~> 4.2.2
- un-comment the line that starts with 'gem "github-pages" ... ' and change it to: 'gem "github-pages", "~> 227", group: :jekyll_plugins'
- make sure that the webrick gem is present (or install it with bundle add webrick)

The '227' number is the version of the github-pages gem and you can check
which is the latest supported version here:
- [https://pages.github.com/versions/]

Now you can save the file and run the install for the dependencies:
```
  $ bundle install
```

## Update the configuration file

To update the configuration, open the _config.yml file that was created
by bundle and add some details of the site:

```
domain: my-site.github.io       # if you want to force HTTPS, specify the domain without the http at the start, e.g. example.com
url: https://my-site.github.io  # the base hostname and protocol for your site, e.g. http://example.com
baseurl: /REPOSITORY-NAME/      # place folder name if the site is served in a subfolder
```

## Using the right Gitignore file

Especially if you are using bundle, there are going to be directories
that do not need to be checked into GIT. To avoid the annoyance of having
non-checked in folders, please use this .gitignore file you can add to
your repository:

```
# Ignore metadata generated by Jekyll
_site/
.sass-cache/
.jekyll-cache/
.jekyll-metadata

# Ignore folders generated by Bundler
.bundle/
vendor/
```

## Adding to GitHub

Now you are ready to push the updates to the origin repo. First add the files:
```
  $ git add .
```
and then you can commit and push as normal:

```
  $ git commit -m 'Initial GitHub pages site with Jekyll'
```
To push updates to the origin, you need to connect this GIT repo to
the one on github:

```
  $ git remote add origin https://github.com/<USER>/<REPOSITORY>.git
```

ready to push:

```
  $ git push -u origin <BRANCH>
```

# Adding Content to the Site

Please refer to this GitHub help page:
- [https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/adding-content-to-your-github-pages-site-using-jekyll]

For changing the theme, please follow the GitHub help page:
- [https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/adding-a-theme-to-your-github-pages-site-using-jekyll]

# Docker Dev Alternative

You can skip the system configuration for ruby and use a Docker image
that is already initialized:
- [https://hub.docker.com/r/bretfisher/jekyll-serve]
